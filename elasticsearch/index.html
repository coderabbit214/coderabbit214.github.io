<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Elasticsearch - 第二大脑</title><meta name="Description" content="第二大脑"><meta property="og:title" content="Elasticsearch" />
<meta property="og:description" content="Elasticsearch 课程目标 了解ES中的基本概念 掌握RESTFul操作ES的CRUD 掌握Spring Data Elasticsearch操作ES 简介 Elasticse" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/elasticsearch/" /><meta property="og:image" content="http://example.org/logo.png"/><meta property="article:section" content="posts" />

<meta property="og:site_name" content="第二大脑" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://example.org/logo.png"/>

<meta name="twitter:title" content="Elasticsearch"/>
<meta name="twitter:description" content="Elasticsearch 课程目标 了解ES中的基本概念 掌握RESTFul操作ES的CRUD 掌握Spring Data Elasticsearch操作ES 简介 Elasticse"/>
<meta name="application-name" content="第二大脑">
<meta name="apple-mobile-web-app-title" content="第二大脑"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/logo.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/elasticsearch/" /><link rel="prev" href="http://example.org/frp-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" /><link rel="next" href="http://example.org/drools/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Elasticsearch",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/elasticsearch\/"
        },"genre": "posts","wordcount":  12234 ,
        "url": "http:\/\/example.org\/elasticsearch\/","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "coderabbit"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="第二大脑"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.png"
        data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x"
        data-sizes="auto"
        alt="/logo.png"
        title="/logo.png" />第二大脑</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="第二大脑"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/logo.png"
        data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x"
        data-sizes="auto"
        alt="/logo.png"
        title="/logo.png" />第二大脑</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Elasticsearch</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/coderabbit214" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>coderabbit</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="0001-01-01">0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;12234 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;25 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#课程目标">课程目标</a></li>
    <li><a href="#简介">简介</a></li>
    <li><a href="#安装和运行">安装和运行</a>
      <ul>
        <li><a href="#后台启动">后台启动</a></li>
        <li><a href="#安装head插件">安装head插件</a></li>
        <li><a href="#安装kibana">安装kibana</a></li>
      </ul>
    </li>
    <li><a href="#概念名词">概念名词</a>
      <ul>
        <li><a href="#数据存储图">数据存储图</a></li>
        <li><a href="#主要组件">主要组件</a></li>
        <li><a href="#分片和副本">分片和副本</a></li>
        <li><a href="#分词器">分词器</a>
          <ul>
            <li><a href="#感受分词器效果">感受分词器效果</a></li>
            <li><a href="#安装ik分词器">安装IK分词器</a></li>
            <li><a href="#拓展词库">拓展词库</a></li>
          </ul>
        </li>
        <li><a href="#倒排索引">倒排索引</a></li>
      </ul>
    </li>
    <li><a href="#基本操作了解">基本操作（了解）</a>
      <ul>
        <li><a href="#索引操作">索引操作</a>
          <ul>
            <li><a href="#建立索引">建立索引</a></li>
            <li><a href="#删除索引">删除索引</a></li>
          </ul>
        </li>
        <li><a href="#映射操作">映射操作</a>
          <ul>
            <li><a href="#建立索引和映射">建立索引和映射</a></li>
            <li><a href="#查询映射">查询映射</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#crud操作">CRUD操作</a>
      <ul>
        <li><a href="#文档操作">文档操作</a>
          <ul>
            <li><a href="#新增和替换文档">新增和替换文档</a></li>
            <li><a href="#查询文档">查询文档</a></li>
            <li><a href="#删除文档">删除文档</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#高级查询">高级查询</a>
      <ul>
        <li><a href="#结果排序">结果排序</a></li>
        <li><a href="#分页查询">分页查询</a></li>
        <li><a href="#检索查询">检索查询</a></li>
        <li><a href="#关键字查询">关键字查询</a></li>
        <li><a href="#高亮显示">高亮显示</a></li>
        <li><a href="#逻辑查询">逻辑查询</a></li>
        <li><a href="#过滤查询">过滤查询</a></li>
        <li><a href="#分组查询">分组查询</a></li>
      </ul>
    </li>
    <li><a href="#批处理了解">批处理（了解）</a>
      <ul>
        <li><a href="#mget批量查询">mget批量查询</a></li>
        <li><a href="#bulk批量增删改">bulk批量增删改</a></li>
      </ul>
    </li>
    <li><a href="#spring-data-elasticsearch">Spring Data Elasticsearch</a>
      <ul>
        <li><a href="#准备环境">准备环境</a>
          <ul>
            <li><a href="#导入依赖">导入依赖</a></li>
            <li><a href="#编写domain">编写domain</a></li>
            <li><a href="#配置连接信息">配置连接信息</a></li>
          </ul>
        </li>
        <li><a href="#elasticsearchrepository">ElasticsearchRepository</a></li>
        <li><a href="#完成crud分页排序">完成CRUD+分页+排序</a></li>
        <li><a href="#组件介绍">组件介绍</a></li>
        <li><a href="#elasticsearchtemplate">ElasticsearchTemplate</a></li>
        <li><a href="#实例代码">实例代码</a></li>
        <li><a href="#springboot23x以上配置">springboot2.3.x以上配置</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="elasticsearch">Elasticsearch</h1>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/elasticsearch.jpg" />
<h2 id="课程目标">课程目标</h2>
<ul>
<li>了解ES中的基本概念</li>
<li>掌握RESTFul操作ES的CRUD</li>
<li>掌握Spring Data Elasticsearch操作ES</li>
</ul>
<h2 id="简介">简介</h2>
<p>Elasticsearch是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>
<p>我们建立一个网站或应用程序，并要添加搜索功能，但是想要完成搜索工作的创建是非常困难的。我们希望搜索解决方案要运行速度快，我们希望能有一个零配置和一个完全免费的搜索模式，我们希望能够简单地使用JSON通过HTTP来索引数据，我们希望我们的搜索服务器始终可用，我们希望能够从一台开始并扩展到数百台，我们要实时搜索，我们要简单的多用户，我们希望建立一个云的解决方案。因此我们利用Elasticsearch来解决所有这些问题及可能出现的更多其它问题。</p>
<h2 id="安装和运行">安装和运行</h2>
<p>该软件是基于Java编写的解压即用的软件，只需要有Java的运行环境即可，把压缩包解压后，进入到bin目录运行elasticsearch.bat，出现以下界面，表示成功启动服务器</p>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606092632.png"/>
<p>浏览器输入：<strong>localhost:9200</strong>，看到浏览器输出服务器的信息，表示安装成功，可以使用了</p>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606093141.png" />
<p>注意：程序启动后有两个端口9200和9300，9200端口用于HTTP协议，基于RESTFul来使用，9300端口用于TCP协议，基于jar包来使用</p>
<h3 id="后台启动">后台启动</h3>
<p>使用<strong>安装目录/bin/elasticsearch-service.bat</strong>程序可以把Elasticsearch安装后服务列表中，以后我们可以在服务列表来启动该程序，也可以设置成开机启动模式</p>
<p>注意：设置后台启动需要手动配置Java虚拟机的路径，使用命令<strong>elasticsearch-service.bat manager</strong>来配置</p>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190622211819.png" />
<h3 id="安装head插件">安装head插件</h3>
<p>Elasticsearch默认的客户端工具是命令行形式的，操作起来不方便，也不直观看到数据的展示，所以我们需要去安装一个可视化插件，但是这些插件都是基于H5开发的，在谷歌的应用商店中找到<strong>elasticsearch-head</strong>插件，然后安装，使用该插件能比较直观的展示服务器中的数据</p>
<h3 id="安装kibana">安装kibana</h3>
<p>该软件也是解压即用的工具，用于管理和监控Elasticsearch的运作，同时内部包含了客户端工具，支持RESTFul操作Elasticsearch。解压后运行bin/kibana.bat，看到启动成功的端口号即可以使用浏览器来使用了</p>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606141235.png" />
<p>浏览器输入：http://localhost:5601</p>
<h2 id="概念名词">概念名词</h2>
<h3 id="数据存储图">数据存储图</h3>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604113843.png" />
<p>注意：从Elasticsearch6开始一个索引里面只能有一个类型，后续计划删除类型这个概念，从ES6开始一般让索引名称和类型名称一致</p>
<h3 id="主要组件">主要组件</h3>
<ul>
<li>
<p>索引</p>
<p>ES将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合。类比传统的关系型数据库领域来说，索引相当于SQL中的一个数据库，或者一个数据存储方案(schema)。索引由其名称(必须为全小写字符)进行标识，并通过引用此名称完成文档的创建、搜索、更新及删除操作。一个ES集群中可以按需创建任意数目的索引。</p>
</li>
<li>
<p>类型</p>
<p>类型是索引内部的逻辑分区(category/partition)，然而其意义完全取决于用户需求。因此，一个索引内部可定义一个或多个类型(type)。一般来说，类型就是为那些拥有相同的域的文档做的预定义。例如，在索引中，可以定义一个用于存储用户数据的类型，一个存储日志数据的类型，以及一个存储评论数据的类型。类比传统的关系型数据库领域来说，类型相当于表。</p>
</li>
<li>
<p>映射</p>
<p>Mapping,就是对索引库中索引的字段名称及其数据类型进行定义，类似于mysql中的表结构信息。不过es的mapping比数据库灵活很多，它可以动态识别字段。一般不需要指定mapping都可以，因为es会自动根据数据格式识别它的类型，如果你需要对某些字段添加特殊属性（如：定义使用其它分词器、是否分词、是否存储等），就必须手动添加mapping。</p>
<p>需要注意的是映射是不可修改的，一旦确定就不允许改动，在使用自动识别功能时，会以第一个存入的文档为参考来建立映射，后面存入的文档也必须符合该映射才能存入</p>
</li>
<li>
<p>文档</p>
<p>文档是Lucene索引和搜索的原子单位，它是包含了一个或多个域的容器，基于JSON格式进行表示。文档由一个或多个域组成，每个域拥有一个名字及一个或多个值，有多个值的域通常称为多值域。每个文档可以存储不同的域集，但同一类型下的文档至应该有某种程度上的相似之处。</p>
</li>
</ul>
<h3 id="分片和副本">分片和副本</h3>
<p>ES的分片(shard)机制可将一个索引内部的数据分布地存储于多个节点，它通过将一个索引切分为多个底层物理的Lucene索引完成索引数据的分割存储功能，这每一个物理的Lucene索引称为一个分片(shard)。每个分片其内部都是一个全功能且独立的索引，因此可由集群中的任何主机存储。创建索引时，用户可指定其分片的数量，默认数量为5个。</p>
<p>Shard有两种类型：primary和replica，即主shard及副本shard。Primary shard用于文档存储，每个新的索引会自动创建5个Primary shard，当然此数量可在索引创建之前通过配置自行定义，不过，一旦创建完成，其Primary shard的数量将不可更改。Replica shard是Primary Shard的副本，用于冗余数据及提高搜索性能。每个Primary shard默认配置了一个Replica shard，但也可以配置多个，且其数量可动态更改。ES会根据需要自动增加或减少这些Replica shard的数量。</p>
<h3 id="分词器">分词器</h3>
<p>把文本内容按照标准进行切分，默认的是standard，该分词器按照单词切分，内容转变为小写，去掉标点，遇到每个中文字符都当成1个单词处理，后面会安装开源的中文分词器插件（ik）</p>
<h4 id="感受分词器效果">感受分词器效果</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">先创建一个名叫shop_product的索引，然后再感受分词效果
</span></span><span class="line"><span class="cl">PUT /shop_product
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">默认分词器：
</span></span><span class="line"><span class="cl">GET /shop_product/_analyze
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;text&#34;:&#34;I am Groot&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GET /shop_product/_analyze
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;text&#34;:&#34;英特尔酷睿i7处理器&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">结论：默认的分词器只能对英文正常分词，不能对中文正常分词
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装ik分词器">安装IK分词器</h4>
<p>直接把压缩文件中的内容解压，然后放在elasticsearch/plugins下，然后重启即可</p>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190611130218.png"/>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">IK分词器：
</span></span><span class="line"><span class="cl">ik_smart：粗力度分词
</span></span><span class="line"><span class="cl">ik_max_word：细力度分词
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GET /shop_product/_analyze
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;text&#34;:&#34;I am Groot&#34;,
</span></span><span class="line"><span class="cl">  &#34;analyzer&#34;:&#34;ik_smart&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GET /shop_product/_analyze
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;text&#34;:&#34;英特尔酷睿i7处理器&#34;,
</span></span><span class="line"><span class="cl">  &#34;analyzer&#34;:&#34;ik_smart&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GET /shop_product/_analyze
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;text&#34;:&#34;英特尔酷睿i7处理器&#34;,
</span></span><span class="line"><span class="cl">  &#34;analyzer&#34;:&#34;ik_max_word&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">结论：都能正常分词
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="拓展词库">拓展词库</h4>
<p>最简单的方式就是找到IK插件中的<strong>config/main.dic</strong>文件，往里面添加新的词汇，然后重启服务器即可</p>
<h3 id="倒排索引">倒排索引</h3>
<img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604141259.png" />
<h2 id="基本操作了解">基本操作（了解）</h2>
<h3 id="索引操作">索引操作</h3>
<p>建表索引，相当于在是在建立数据库</p>
<h4 id="建立索引">建立索引</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：PUT /索引名
</span></span><span class="line"><span class="cl">在没有特殊设置的情况下，默认有5个分片，1个备份，也可以通过请求参数的方式来指定
</span></span><span class="line"><span class="cl">参数格式：
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;settings&#34;: {
</span></span><span class="line"><span class="cl">    &#34;number_of_shards&#34;: 5, //设置5个片区
</span></span><span class="line"><span class="cl">    &#34;number_of_replicas&#34;: 1 //设置1个备份
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="删除索引">删除索引</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：DELETE /索引名
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="映射操作">映射操作</h3>
<h4 id="建立索引和映射">建立索引和映射</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：PUT /索引名
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;mappings&#34;: {
</span></span><span class="line"><span class="cl">    类型名: {
</span></span><span class="line"><span class="cl">      &#34;properties..0&#34;: {
</span></span><span class="line"><span class="cl">        字段名: {
</span></span><span class="line"><span class="cl">          &#34;type&#34;: 字段类型, 
</span></span><span class="line"><span class="cl">          &#34;analyzer&#34;: 分词器类型, 
</span></span><span class="line"><span class="cl">          &#34;search_analyzer&#34;: 分词器类型,
</span></span><span class="line"><span class="cl">          ...
</span></span><span class="line"><span class="cl">        },
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">字段类型：double / long / integer / text / keyword / date / binary
</span></span><span class="line"><span class="cl">注意：text和keyword都是字符串类型，但是只有text类型的数据才能分词，字段的配置一旦确定就不能更改
</span></span><span class="line"><span class="cl">映射的配置项有很多，我们可以根据需要只配置用得上的属性
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="查询映射">查询映射</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：GET /索引名/_mapping
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="crud操作">CRUD操作</h2>
<h3 id="文档操作">文档操作</h3>
<h4 id="新增和替换文档">新增和替换文档</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：PUT /索引名/类型名/文档ID
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  field1: value1,
</span></span><span class="line"><span class="cl">  field2: value2,
</span></span><span class="line"><span class="cl">  ...
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">注意：当索引/类型/映射不存在时，会使用默认设置自动添加
</span></span><span class="line"><span class="cl">ES中的数据一般是从别的数据库导入的，所以文档的ID会沿用原数据库中的ID
</span></span><span class="line"><span class="cl">索引库中没有该ID对应的文档时则新增，拥有该ID对应的文档时则替换
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">需求1：新增一个文档
</span></span><span class="line"><span class="cl">需求2：替换一个文档
</span></span></code></pre></td></tr></table>
</div>
</div><p>每一个文档都内置以下字段</p>
<blockquote>
<p>_index：所属索引</p>
<p>_type：所属类型</p>
<p>_id：文档ID</p>
<p>_version：乐观锁版本号</p>
<p>_source：数据内容</p>
</blockquote>
<h4 id="查询文档">查询文档</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：
</span></span><span class="line"><span class="cl">根据ID查询 -&gt; GET /索引名/类型名/文档ID
</span></span><span class="line"><span class="cl">查询所有（基本查询语句） -&gt; GET /索引名/类型名/_search
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">需求1：根据文档ID查询一个文档
</span></span><span class="line"><span class="cl">需求2：查询所有的文档 
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询所有结果中包含以下字段</p>
<blockquote>
<p>took：耗时</p>
<p>_shards.total：分片总数</p>
<p>hits.total：查询到的数量</p>
<p>hits.max_score：最大匹配度</p>
<p>hits.hits：查询到的结果</p>
<p>hits.hits._score：匹配度</p>
</blockquote>
<h4 id="删除文档">删除文档</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：DELETE /索引名/类型名/文档ID
</span></span><span class="line"><span class="cl">注意：这里的删除并且不是真正意义上的删除，仅仅是清空文档内容而已，并且标记该文档的状态为删除
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">需求1：根据文档ID删除一个文档
</span></span><span class="line"><span class="cl">需求2：替换刚刚删除的文档
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="高级查询">高级查询</h2>
<p>数据准备：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">PUT</span> <span class="err">/shop_product</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;mappings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;shop_product&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;integer&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;title&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;text&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;analyzer&#34;</span><span class="p">:</span> <span class="s2">&#34;ik_smart&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;search_analyzer&#34;</span><span class="p">:</span> <span class="s2">&#34;ik_smart&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;price&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;double&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;intro&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;text&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;analyzer&#34;</span><span class="p">:</span> <span class="s2">&#34;ik_smart&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;search_analyzer&#34;</span><span class="p">:</span> <span class="s2">&#34;ik_smart&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;brand&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;keyword&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">POST</span> <span class="err">/shop_product/shop_product/_bulk</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Apple iPhone XR (A2108) 128GB 白色 移动联通电信4G手机 双卡双待&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">5299</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;【iPhoneXR限时特惠！】6.1英寸视网膜显示屏，A12仿生芯片，面容识别，无线充电，支持双卡！选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;Apple&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Apple 2019款 Macbook Pro 13.3【带触控栏】八代i7 18G 256G RP645显卡 深空灰 苹果笔记本电脑 轻薄本 MUHN2CH/A&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">15299</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;【八月精选】Pro2019年新品上市送三重好礼，现在购买领满8000减400元优惠神劵，劵后更优惠！&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;Apple&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Apple iPad Air 3 2019年新款平板电脑 10.5英寸（64G WLAN版/A12芯片/Retina显示屏/MUUL2CH/A）金色&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">3788</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;8月尊享好礼！买iPad即送蓝牙耳机！领券立减！多款产品支持手写笔！【新一代iPad，总有一款适合你】选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;Apple&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;华为HUAWEI MateBook X Pro 2019款 英特尔酷睿i5 13.9英寸全面屏轻薄笔记本电脑(i5 8G 512G 3K 触控) 灰&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">7999</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;3K全面屏开启无界视野;轻薄设计灵动有型，HuaweiShare一碰传&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;华为&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;华为 HUAWEI Mate20 X (5G) 7nm工艺5G旗舰芯片全面屏超大广角徕卡三摄8GB+256GB翡冷翠5G双模全网通手机&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">6199</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;【5G双模，支持SA/NSA网络，7.2英寸全景巨屏，石墨烯液冷散热】5G先驱，极速体验。&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;华为&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;华为平板 M6 10.8英寸麒麟980影音娱乐平板电脑4GB+64GB WiFi（香槟金）&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">2299</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;【华为暑期购】8月2日-4日，M5青春版指定爆款型号优惠100元，AI语音控制&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;华为&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;荣耀20 PRO DXOMARK全球第二高分 4800万四摄 双光学防抖 麒麟980 全网通4G 8GB+128GB 蓝水翡翠 拍照手机&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">3199</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;白条6期免息！麒麟980，4800万全焦段AI四摄！荣耀20系列2699起，4800万超广角AI四摄！&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;荣耀&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;荣耀MagicBook Pro 16.1英寸全面屏轻薄性能笔记本电脑（酷睿i7 8G 512G MX250 IPS FHD 指纹解锁）冰河银&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">6199</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;16.1英寸无界全面屏金属轻薄本，100%sRGB色域，全高清IPS防眩光护眼屏，14小时长续航，指纹一健开机登录，魔法一碰传高速传输。&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;荣耀&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;荣耀平板5 麒麟8核芯片 GT游戏加速 4G+128G 10.1英寸全高清屏影音平板电脑 WiFi版 冰川蓝&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">1549</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;【爆款平板推荐】哈曼卡顿专业调音，10.1英寸全高清大屏，双喇叭立体环绕音，配置多重护眼，值得拥有！&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;荣耀&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;小米9 4800万超广角三摄 6GB+128GB全息幻彩蓝 骁龙855 全网通4G 双卡双待 水滴全面屏拍照智能游戏手机&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">2799</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;限时优惠200，成交价2799！索尼4800万广角微距三摄，屏下指纹解锁！&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;小米&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">11</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;小米(MI)Pro 2019款 15.6英寸金属轻薄笔记本(第八代英特尔酷睿i7-8550U 16G 512GSSD MX250 2G独显) 深空灰&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">6899</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;【PCIE固态硬盘、72%NTSC高色域全高清屏】B面康宁玻璃覆盖、16G双通道大内存、第八代酷睿I7处理器、专业级调校MX150&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;小米&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;create&#34;</span><span class="p">:{</span><span class="nt">&#34;_id&#34;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;id&#34;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="nt">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;联想(Lenovo)拯救者Y7000P 2019英特尔酷睿i7 15.6英寸游戏笔记本电脑(i7 9750H 16G 1T SSD GTX1660Ti 144Hz)&#34;</span><span class="p">,</span><span class="nt">&#34;price&#34;</span><span class="p">:</span><span class="mi">9299</span><span class="p">,</span><span class="nt">&#34;intro&#34;</span><span class="p">:</span><span class="s2">&#34;超大1T固态，升级双通道16G内存一步到位，GTX1660Ti电竞级独显，英特尔9代i7H高性能处理器，144Hz电竞屏窄边框！&#34;</span><span class="p">,</span><span class="nt">&#34;brand&#34;</span><span class="p">:</span><span class="s2">&#34;联想&#34;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Elasticsearch基于JSON提供完整的查询DSL（Domain Specific Language：领域特定语言）来定义查询。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">基本语法：
</span></span><span class="line"><span class="cl">GET /索引名/类型名/_search
</span></span></code></pre></td></tr></table>
</div>
</div><p>一般都是需要配合查询参数来使用的，配合不同的参数有不同的查询效果</p>
<p>参数配置项可以参考博客：<a href="https://www.jianshu.com/p/6333940621ec" target="_blank" rel="noopener noreffer ">https://www.jianshu.com/p/6333940621ec</a></p>
<h3 id="结果排序">结果排序</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sort&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="err">field:</span> <span class="err">排序规则</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="err">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">排序</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sort&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;price&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="s2">&#34;desc&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">排序规则：</span>
</span></span><span class="line"><span class="cl"><span class="err">asc表示升序</span>
</span></span><span class="line"><span class="cl"><span class="err">desc:表示降序</span>
</span></span><span class="line"><span class="cl"><span class="err">没有配置排序的情况下，默认按照评分降序排列</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="分页查询">分页查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;from&#34;</span><span class="p">:</span> <span class="err">start</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="err">pageSize</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">分页</span> <span class="err">从第几个开始</span> <span class="err">每页几个</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;from&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sort&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;price&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="s2">&#34;desc&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询所有文档按照价格降序排列</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">2</span><span class="err">：分页查询文档按照价格降序排列，显示第</span><span class="mi">2</span><span class="err">页，每页显示</span><span class="mi">3</span><span class="err">个</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="检索查询">检索查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">检索方式:</span> <span class="err">{field:</span> <span class="err">value</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">检索查询</span> <span class="err">全文检索</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题中符合</span><span class="s2">&#34;游戏 手机&#34;</span><span class="err">的字样的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;match&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;游戏 手机&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">检索查询</span> <span class="err">精准匹配</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">2</span><span class="err">：查询商品价格等于</span><span class="mi">15299</span><span class="err">的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;term&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;price&#34;</span><span class="p">:</span> <span class="mi">15299</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">检索查询</span> <span class="err">范围检索</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">3</span><span class="err">：查询商品价格在</span><span class="mi">5000</span><span class="err">~</span><span class="mi">10000</span><span class="err">之间商品，按照价格升序排列</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;range&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;price&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;gte&#34;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;lte&#34;</span><span class="p">:</span> <span class="mi">10000</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sort&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;price&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="s2">&#34;asc&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">检索方式：</span>
</span></span><span class="line"><span class="cl"><span class="err">term表示精确匹配，value值不会被分词器拆分，按照倒排索引匹配</span>
</span></span><span class="line"><span class="cl"><span class="err">match表示全文检索，value值会被分词器拆分，然后去倒排索引中匹配</span>
</span></span><span class="line"><span class="cl"><span class="err">range表示范围检索，其value值是一个对象，如</span><span class="p">{</span> <span class="nt">&#34;range&#34;</span><span class="p">:</span> <span class="p">{</span><span class="err">field:</span> <span class="err">{比较规则:</span> <span class="err">value,</span> <span class="err">...</span><span class="p">}}</span> <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">比较规则有gt</span> <span class="err">/</span> <span class="err">gte</span> <span class="err">/</span> <span class="err">lt</span> <span class="err">/</span> <span class="err">lte</span> <span class="err">等</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="err">注意：term和match都能用在数值和字符上，range用在数值上</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题中符合</span><span class="s2">&#34;游戏 手机&#34;</span><span class="err">的字样的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">2</span><span class="err">：查询商品价格等于</span><span class="mi">15299</span><span class="err">的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">3</span><span class="err">：查询商品价格在</span><span class="mi">5000</span><span class="err">~</span><span class="mi">10000</span><span class="err">之间商品，按照价格升序排列</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="关键字查询">关键字查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;multi_match&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="err">value</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">field</span><span class="mi">1</span><span class="p">,</span> <span class="err">field</span><span class="mi">2</span><span class="p">,</span> <span class="err">...</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">关键字查询</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题或简介中符合</span><span class="s2">&#34;蓝牙 指纹 双卡&#34;</span><span class="err">的字样的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;multi_match&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="s2">&#34;蓝牙 指纹 双卡&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;intro&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">multi_match：表示在多个字段间做检索，只要其中一个字段满足条件就能查询出来，多用在字段上</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题或简介中符合</span><span class="s2">&#34;蓝牙 指纹 双卡&#34;</span><span class="err">的字样的商品</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="高亮显示">高亮显示</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="err">...</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;highlight&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="err">field1:</span> <span class="err">{</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="err">field2:</span> <span class="err">{</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="err">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="err">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pre_tags&#34;</span><span class="err">:</span> <span class="err">开始标签,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;post_tags&#34;</span> <span class="err">结束标签</span>
</span></span><span class="line"><span class="cl">  <span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">高亮显示</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题或简介中符合</span><span class="s2">&#34;蓝牙 指纹 双卡&#34;</span><span class="err">的字样的商品，并且高亮显示</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;multi_match&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="s2">&#34;蓝牙 指纹 双卡&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;intro&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;highlight&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;intro&#34;</span><span class="p">:</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;pre_tags&#34;</span><span class="p">:</span><span class="s2">&#34;&lt;h1&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;post_tags&#34;</span><span class="p">:</span><span class="s2">&#34;&lt;/h1&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">highlight：表示高亮显示，需要在fields中配置哪些字段中检索到该内容需要高亮显示</span>
</span></span><span class="line"><span class="cl">  <span class="err">必须配合检索(term</span> <span class="err">/</span> <span class="err">match)一起使用</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题或简介中符合</span><span class="s2">&#34;蓝牙 指纹 双卡&#34;</span><span class="err">的字样的商品，并且高亮显示</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="逻辑查询">逻辑查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;bool&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="err">逻辑规则:</span> <span class="err">[</span>
</span></span><span class="line"><span class="cl">        <span class="err">{检索方式:</span> <span class="err">{field:</span> <span class="err">value</span><span class="p">}},</span> 
</span></span><span class="line"><span class="cl">        <span class="err">...</span>
</span></span><span class="line"><span class="cl">      <span class="err">],</span>
</span></span><span class="line"><span class="cl">      <span class="err">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">逻辑查询</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题中符合</span><span class="s2">&#34;i7&#34;</span><span class="err">的字样并且价格大于</span><span class="mi">7000</span><span class="err">的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;bool&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;must&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;match&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;i7&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;range&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;price&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;gt&#34;</span><span class="p">:</span> <span class="mi">7000</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">逻辑查询</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">2</span><span class="err">：查询商品标题中符合</span><span class="s2">&#34;pro&#34;</span><span class="err">的字样或者价格在</span><span class="mi">1000</span><span class="err">~</span><span class="mi">3000</span><span class="err">的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;bool&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;should&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;match&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;pro&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;range&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;price&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;gte&#34;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;lte&#34;</span><span class="p">:</span> <span class="mi">3000</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">逻辑规则：must</span> <span class="err">/</span> <span class="err">should</span> <span class="err">/</span> <span class="err">must_not，相当于and</span> <span class="err">/</span> <span class="err">or</span> <span class="err">/</span> <span class="err">not</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：查询商品标题中符合</span><span class="s2">&#34;i7&#34;</span><span class="err">的字样并且价格大于</span><span class="mi">7000</span><span class="err">的商品</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">2</span><span class="err">：查询商品标题中符合</span><span class="s2">&#34;pro&#34;</span><span class="err">的字样或者价格在</span><span class="mi">1000</span><span class="err">~</span><span class="mi">3000</span><span class="err">的商品</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="过滤查询">过滤查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;bool&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;filter&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span> <span class="err">检索方式:</span> <span class="err">{</span> <span class="err">field:</span> <span class="err">value</span> <span class="p">}</span> <span class="err">}，</span>            	
</span></span><span class="line"><span class="cl">        <span class="err">...</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>             
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">过滤查询</span> <span class="err">不评分</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;query&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;bool&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;filter&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;match&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;pro&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">从效果上讲过滤查询和检索查询能做一样的效果</span>
</span></span><span class="line"><span class="cl"><span class="err">区别在于过滤查询不评分，结果能缓存，检索查询要评分，结果不缓存</span>
</span></span><span class="line"><span class="cl"><span class="err">一般是不会直接使用过滤查询，都是在检索了一定数据的基础上再使用</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>关于filter的更多认知推荐大家读这篇博客：<a href="https://blog.csdn.net/laoyang360/article/details/80468757" target="_blank" rel="noopener noreffer ">https://blog.csdn.net/laoyang360/article/details/80468757</a></p>
<h3 id="分组查询">分组查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">参数格式：</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">自定义分组字段:</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;terms&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="err">分组字段</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">{</span><span class="err">自定义统计字段:排序规则</span><span class="p">},</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">10</span>  <span class="c1">//默认显示10组 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span> <span class="c1">//分组后的统计查询，相当于MySQL分组函数查询
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="err">自定义统计字段:</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">          <span class="err">分组运算:</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="err">统计字段</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>       
</span></span><span class="line"><span class="cl">    <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">分组查询</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：按照品牌分组，统计各品牌的数量</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;brand_group&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;terms&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;brand&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;brand_group&#34;</span><span class="p">:</span><span class="s2">&#34;desc&#34;</span><span class="p">},</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">10</span>  
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;brand_group&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;value_count&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;id&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>       
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">分组查询</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">2</span><span class="err">：按照品牌分组，统计各品牌的平均价格</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;brand_group&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;terms&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;brand&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;brand_group&#34;</span><span class="p">:</span><span class="s2">&#34;desc&#34;</span><span class="p">},</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">10</span>  
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;brand_group&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;avg&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;price&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>       
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">分组查询</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">3</span><span class="err">：按照品牌分组，统计各品牌的价格数据</span>
</span></span><span class="line"><span class="cl"><span class="err">GET</span> <span class="err">/shop_product/shop_product/_search</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;brand_group_aggs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;terms&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;brand&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;brand_group_aggs.count&#34;</span><span class="p">:</span><span class="s2">&#34;desc&#34;</span><span class="p">},</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">10</span>  
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;aggs&#34;</span><span class="p">:</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;brand_group_aggs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;stats&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;price&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>       
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">分组运算：avg</span> <span class="err">/</span> <span class="err">sum</span> <span class="err">/</span> <span class="err">min</span> <span class="err">/</span> <span class="err">max</span> <span class="err">/</span> <span class="err">value_count</span> <span class="err">/</span> <span class="err">stats(执行以上所有功能的)</span>
</span></span><span class="line"><span class="cl"><span class="err">注意：这里是size=</span><span class="mi">0</span><span class="err">其目的是为了不要显示hit内容，专注点放在观察分组上</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">1</span><span class="err">：按照品牌分组，统计各品牌的数量</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">2</span><span class="err">：按照品牌分组，统计各品牌的平均价格</span>
</span></span><span class="line"><span class="cl"><span class="err">需求</span><span class="mi">3</span><span class="err">：按照品牌分组，统计各品牌的价格数据</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="批处理了解">批处理（了解）</h2>
<p>当需要集中的批量处理文档时，如果依然使用传统的操作单个API的方式，将会浪费大量网络资源，Elasticsearch为了提高操作的性能，专门提供了批处理的API</p>
<h3 id="mget批量查询">mget批量查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：
</span></span><span class="line"><span class="cl">GET /索引名/类型/_mget
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;docs&#34;: [
</span></span><span class="line"><span class="cl">    {&#34;_id&#34;: 文档ID},
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">  ]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bulk批量增删改">bulk批量增删改</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">语法：
</span></span><span class="line"><span class="cl">POST /索引名/类型/_bulk
</span></span><span class="line"><span class="cl">{动作:{&#34;_id&#34;: 文档ID}}
</span></span><span class="line"><span class="cl">{...}
</span></span><span class="line"><span class="cl">{动作:{&#34;_id&#34;: 文档ID}}
</span></span><span class="line"><span class="cl">{...}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">动作：create / update / delete，其中delete只有1行JSON，其他操作都是有2行JSON，并且JSON不能格式化，如果是update动作，它的数据需要加个key为doc
</span></span><span class="line"><span class="cl">如：
</span></span><span class="line"><span class="cl">{&#34;update&#34;: {&#34;_id&#34;: xx}}
</span></span><span class="line"><span class="cl">{&#34;doc&#34;: {&#34;xx&#34;:xx, &#34;xx&#34;:xx}}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="spring-data-elasticsearch">Spring Data Elasticsearch</h2>
<h3 id="准备环境">准备环境</h3>
<h4 id="导入依赖">导入依赖</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;parent&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2.1.3.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/parent&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--SpringBoot整合Spring Data Elasticsearch的依赖--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-elasticsearch<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>commons-beanutils<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>commons-beanutils<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.8.3<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="编写domain">编写domain</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">  @Document：配置操作哪个索引下的哪个类型
</span></span></span><span class="line"><span class="cl"><span class="cm">  @Id：标记文档ID字段
</span></span></span><span class="line"><span class="cl"><span class="cm">  @Field：配置映射信息，如：分词器
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Getter@Setter@ToString</span>
</span></span><span class="line"><span class="cl"><span class="nd">@NoArgsConstructor</span>
</span></span><span class="line"><span class="cl"><span class="nd">@AllArgsConstructor</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Document</span><span class="o">(</span><span class="n">indexName</span><span class="o">=</span><span class="s">&#34;shop_product&#34;</span><span class="o">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;shop_product&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Id</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Field</span><span class="o">(</span><span class="n">analyzer</span><span class="o">=</span><span class="s">&#34;ik_max_word&#34;</span><span class="o">,</span><span class="n">searchAnalyzer</span><span class="o">=</span><span class="s">&#34;ik_max_word&#34;</span><span class="o">,</span> <span class="n">type</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="na">Text</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">price</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Field</span><span class="o">(</span><span class="n">analyzer</span><span class="o">=</span><span class="s">&#34;ik_max_word&#34;</span><span class="o">,</span><span class="n">searchAnalyzer</span><span class="o">=</span><span class="s">&#34;ik_max_word&#34;</span><span class="o">,</span> <span class="n">type</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="na">Text</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">intro</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Field</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="na">Keyword</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">brand</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="配置连接信息">配置连接信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#application.properties
</span></span><span class="line"><span class="cl"># 配置集群名称，名称写错会连不上服务器，默认elasticsearch
</span></span><span class="line"><span class="cl">spring.data.elasticsearch.cluster-name=elasticsearch
</span></span><span class="line"><span class="cl"># 配置集群节点
</span></span><span class="line"><span class="cl">spring.data.elasticsearch.cluster-nodes=localhost:9300
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="elasticsearchrepository">ElasticsearchRepository</h3>
<p>该接口是框架封装的用于操作Elastsearch的高级接口，只要我们自己的写个接口去继承该接口就能直接对Elasticsearch进行CRUD操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">  泛型1：domain的类型
</span></span></span><span class="line"><span class="cl"><span class="cm">  泛型2：文档主键类型
</span></span></span><span class="line"><span class="cl"><span class="cm">  该接口直接该给Spring，底层会使用JDK代理的方式创建对象，交给容器管理
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Repository</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductESRepository</span> <span class="kd">extends</span> <span class="n">ElasticsearchRepository</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 符合Spring Data规范的高级查询方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="完成crud分页排序">完成CRUD+分页+排序</h3>
<h3 id="组件介绍">组件介绍</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ElasticsearchRepository：框架封装的用于便捷完成常用操作的工具接口
</span></span><span class="line"><span class="cl">ElasticsearchTemplate：框架封装的用于便捷操作Elasticsearch的模板类
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NativeSearchQueryBuilder：用于生成查询条件的构建器，需要去封装各种查询条件
</span></span><span class="line"><span class="cl">QueryBuilder：该接口表示一个查询条件，其对象可以通过QueryBuilders工具类中的方法快速生成各种条件
</span></span><span class="line"><span class="cl">  boolQuery()：生成bool条件，相当于 &#34;bool&#34;: { }
</span></span><span class="line"><span class="cl">  matchQuery()：生成match条件，相当于 &#34;match&#34;: { }
</span></span><span class="line"><span class="cl">  rangeQuery()：生成range条件，相当于 &#34;range&#34;: { }
</span></span><span class="line"><span class="cl">AbstractAggregationBuilder：用于生成分组查询的构建器，其对象通过AggregationBuilders工具类生成
</span></span><span class="line"><span class="cl">Pageable：表示分页参数，对象通过PageRequest.of(页数, 容量)获取
</span></span><span class="line"><span class="cl">SortBuilder：排序构建器，对象通过SortBuilders.fieldSort(字段).order(规则)获取
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="elasticsearchtemplate">ElasticsearchTemplate</h3>
<p>该模板类，封装了便捷操作Elasticsearch的模板方法，包括 索引 / 映射 / CRUD 等底层操作和高级操作，该对象用起来会略微复杂些，尤其是对于查询，还需要把查询到的结果自己封装对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//该对象已经由SpringBoot完成自动配置，直接注入即可
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">ElasticsearchTemplate</span> <span class="n">template</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>一般情况下，ElasticsearchTemplate和ElasticsearchRepository是分工合作的，ElasticsearchRepository已经能完成绝大部分的功能，如果遇到复杂的查询则要使用ElasticsearchTemplate，如多字段分组、高亮显示等</p>
<h3 id="实例代码">实例代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">ElasticsearchTemplate</span> <span class="n">template</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">ProductESRepository</span> <span class="n">repository</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 新增或者覆盖一个文档
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveOrUpdate</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 索引库中不存在则新增，存在则覆盖
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="s">&#34;13&#34;</span><span class="o">,</span> <span class="s">&#34;华为手环 B5（Android 运动手环）&#34;</span><span class="o">,</span> <span class="n">999</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s">&#34;高清彩屏 腕上蓝牙耳机 心率检测 来电消息提醒&#34;</span><span class="o">,</span> <span class="s">&#34;华为&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">repostitory</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 删除一个文档
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDelete</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">repostitory</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="s">&#34;13&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 根据ID查询一个文档
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">optional</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">optional</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询所有文档
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testList</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">iter</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 分页查询文档按照价格降序排列，显示第2页，每页显示3个
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery1</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 设置分页信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">builder</span><span class="o">.</span><span class="na">withPageable</span><span class="o">(</span><span class="n">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">3</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 设置排序信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">builder</span><span class="o">.</span><span class="na">withSort</span><span class="o">(</span><span class="n">SortBuilders</span><span class="o">.</span><span class="na">fieldSort</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">).</span><span class="na">order</span><span class="o">(</span><span class="n">SortOrder</span><span class="o">.</span><span class="na">DESC</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getTotalElements</span><span class="o">());</span> <span class="c1">//总记录数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getTotalPages</span><span class="o">());</span> <span class="c1">//总页数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询商品标题中符合&#34;游戏 手机&#34;的字样的商品
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery2</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withQuery</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">matchQuery</span><span class="o">(</span><span class="s">&#34;title&#34;</span><span class="o">,</span> <span class="s">&#34;游戏 手机&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询商品价格等于15299的商品
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery3</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withQuery</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">termQuery</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">,</span> <span class="n">15299</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询商品价格在5000~9000之间商品，按照价格升序排列
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery4</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withQuery</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">rangeQuery</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">gte</span><span class="o">(</span><span class="n">5000</span><span class="o">).</span><span class="na">lte</span><span class="o">(</span><span class="n">9000</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withSort</span><span class="o">(</span><span class="n">SortBuilders</span><span class="o">.</span><span class="na">fieldSort</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">).</span><span class="na">order</span><span class="o">(</span><span class="n">SortOrder</span><span class="o">.</span><span class="na">ASC</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询商品标题或简介中符合&#34;蓝牙 指纹 双卡&#34;的字样的商品
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery5</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withQuery</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">multiMatchQuery</span><span class="o">(</span><span class="s">&#34;蓝牙 指纹 双卡&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                      <span class="s">&#34;title&#34;</span><span class="o">,</span> <span class="s">&#34;intro&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询商品标题中符合&#34;i7&#34;的字样并且价格大于7000的商品
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery6</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withQuery</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">boolQuery</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">must</span><span class="o">(</span><span class="n">QueryBuilders</span><span class="o">.</span><span class="na">matchQuery</span><span class="o">(</span><span class="s">&#34;title&#34;</span><span class="o">,</span> <span class="s">&#34;i7&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">must</span><span class="o">(</span><span class="n">QueryBuilders</span><span class="o">.</span><span class="na">rangeQuery</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">).</span><span class="na">gt</span><span class="o">(</span><span class="n">7000</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询商品标题中符合&#34;pro&#34;的字样或者价格在1000~3000的商品
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery7</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withQuery</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">boolQuery</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">should</span><span class="o">(</span><span class="n">QueryBuilders</span><span class="o">.</span><span class="na">matchQuery</span><span class="o">(</span><span class="s">&#34;title&#34;</span><span class="o">,</span> <span class="s">&#34;pro&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">should</span><span class="o">(</span><span class="n">QueryBuilders</span><span class="o">.</span><span class="na">rangeQuery</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">).</span><span class="na">gte</span><span class="o">(</span><span class="n">1000</span><span class="o">).</span><span class="na">lte</span><span class="o">(</span><span class="n">3000</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 按照品牌分组，统计各品牌的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery8</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">addAggregation</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">AggregationBuilders</span><span class="o">.</span><span class="na">terms</span><span class="o">(</span><span class="s">&#34;groupByBrand&#34;</span><span class="o">).</span><span class="na">field</span><span class="o">(</span><span class="s">&#34;brand&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="o">(</span><span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;)</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 获取自定义的分组字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">StringTerms</span> <span class="n">brand</span> <span class="o">=</span> <span class="o">(</span><span class="n">StringTerms</span><span class="o">)</span> <span class="n">page</span><span class="o">.</span><span class="na">getAggregation</span><span class="o">(</span><span class="s">&#34;groupByBrand&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">brand</span><span class="o">.</span><span class="na">getBuckets</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">bucket</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bucket</span><span class="o">.</span><span class="na">getDocCount</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 按照品牌分组，统计各品牌的平均价格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery9</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">addAggregation</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">AggregationBuilders</span><span class="o">.</span><span class="na">terms</span><span class="o">(</span><span class="s">&#34;groupByBrand&#34;</span><span class="o">).</span><span class="na">field</span><span class="o">(</span><span class="s">&#34;brand&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">subAggregation</span><span class="o">(</span><span class="n">AggregationBuilders</span><span class="o">.</span><span class="na">avg</span><span class="o">(</span><span class="s">&#34;avgPrice&#34;</span><span class="o">).</span><span class="na">field</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="o">(</span><span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;)</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 获取自定义的分组字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">StringTerms</span> <span class="n">brand</span> <span class="o">=</span> <span class="o">(</span><span class="n">StringTerms</span><span class="o">)</span> <span class="n">page</span><span class="o">.</span><span class="na">getAggregation</span><span class="o">(</span><span class="s">&#34;groupByBrand&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">brand</span><span class="o">.</span><span class="na">getBuckets</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">bucket</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">InternalAvg</span> <span class="n">avgPrice</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">getAggregations</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;avgPrice&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">avgPrice</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">});</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 按照品牌分组，统计各品牌的价格数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuery10</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">addAggregation</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">AggregationBuilders</span><span class="o">.</span><span class="na">terms</span><span class="o">(</span><span class="s">&#34;groupByBrand&#34;</span><span class="o">).</span><span class="na">field</span><span class="o">(</span><span class="s">&#34;brand&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">subAggregation</span><span class="o">(</span><span class="n">AggregationBuilders</span><span class="o">.</span><span class="na">stats</span><span class="o">(</span><span class="s">&#34;statsPrice&#34;</span><span class="o">).</span><span class="na">field</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="o">(</span><span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;)</span> <span class="n">repostitory</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 获取自定义的分组字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">StringTerms</span> <span class="n">brand</span> <span class="o">=</span> <span class="o">(</span><span class="n">StringTerms</span><span class="o">)</span> <span class="n">page</span><span class="o">.</span><span class="na">getAggregation</span><span class="o">(</span><span class="s">&#34;groupByBrand&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">brand</span><span class="o">.</span><span class="na">getBuckets</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">bucket</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">InternalStats</span> <span class="n">statsPrice</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">getAggregations</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;statsPrice&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">statsPrice</span><span class="o">.</span><span class="na">getSumAsString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">statsPrice</span><span class="o">.</span><span class="na">getAvgAsString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">statsPrice</span><span class="o">.</span><span class="na">getMaxAsString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">statsPrice</span><span class="o">.</span><span class="na">getMinAsString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">statsPrice</span><span class="o">.</span><span class="na">getCount</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;-----------------------&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">});</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 查询商品标题或简介中符合&#34;蓝牙 指纹 双卡&#34;的字样的商品，并且高亮显示
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testHighlight</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Java与JSON互转的工具对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">NativeSearchQueryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 设置查询哪个索引中的哪个类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">builder</span><span class="o">.</span><span class="na">withIndices</span><span class="o">(</span><span class="s">&#34;shop_product&#34;</span><span class="o">).</span><span class="na">withTypes</span><span class="o">(</span><span class="s">&#34;shop_product&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withQuery</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">multiMatchQuery</span><span class="o">(</span><span class="s">&#34;蓝牙 指纹 双卡&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                      <span class="s">&#34;title&#34;</span><span class="o">,</span> <span class="s">&#34;intro&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="o">.</span><span class="na">withHighlightFields</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">HighlightBuilder</span><span class="o">.</span><span class="na">Field</span><span class="o">(</span><span class="s">&#34;title&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">preTags</span><span class="o">(</span><span class="s">&#34;&lt;span style=&#39;color:red&#39;&gt;&#34;</span><span class="o">).</span><span class="na">postTags</span><span class="o">(</span><span class="s">&#34;&lt;/span&gt;&#34;</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">HighlightBuilder</span><span class="o">.</span><span class="na">Field</span><span class="o">(</span><span class="s">&#34;intro&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">preTags</span><span class="o">(</span><span class="s">&#34;&lt;span style=&#39;color:red&#39;&gt;&#34;</span><span class="o">).</span><span class="na">postTags</span><span class="o">(</span><span class="s">&#34;&lt;/span&gt;&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="na">queryForPage</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">(),</span> <span class="n">Product</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">SearchResultMapper</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">mapResults</span><span class="o">(</span><span class="n">SearchResponse</span> <span class="n">resp</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="o">(</span><span class="n">SearchHit</span> <span class="n">hit</span> <span class="o">:</span> <span class="n">resp</span><span class="o">.</span><span class="na">getHits</span><span class="o">().</span><span class="na">getHits</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// 把查询到的JSON字符串转换成Java对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">hit</span><span class="o">.</span><span class="na">getSourceAsString</span><span class="o">(),</span> <span class="n">clazz</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="o">(</span><span class="n">HighlightField</span> <span class="n">field</span> <span class="o">:</span> <span class="n">hit</span><span class="o">.</span><span class="na">getHighlightFields</span><span class="o">().</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// 替换需要高亮显示的字段，用到Apache的BeanUtils工具
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">BeanUtils</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">field</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">field</span><span class="o">.</span><span class="na">getFragments</span><span class="o">()[</span><span class="n">0</span><span class="o">].</span><span class="na">string</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">getHits</span><span class="o">().</span><span class="na">totalHits</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">AggregatedPageImpl</span><span class="o">&lt;&gt;(</span><span class="n">list</span><span class="o">,</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">page</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="springboot23x以上配置">springboot2.3.x以上配置</h3>
<blockquote>
<p><a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.0.1.RELEASE/reference/html/#new-features" target="_blank" rel="noopener noreffer ">配置关系对应</a></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png"
        data-srcset="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png, https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png 1.5x, https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png 2x"
        data-sizes="auto"
        alt="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png"
        title="截屏2021-08-14 14.17.14" /></p>
</blockquote>
<ol>
<li>
<p>pom相同</p>
</li>
<li>
<p>配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 旧版本以spring.data.elasticsearch.开头;访问地址配置不用声明访问协议,监听es的tcp端口
</span></span><span class="line"><span class="cl">#spring.data.elasticsearch.cluster-nodes=localhost:9300
</span></span><span class="line"><span class="cl">#spring.data.elasticsearch.cluster-name=elasticsearch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## 新版本以spring.elasticsearch.rest.开头;访问地址配置需要声明访问协议,直接监听es访问端口
</span></span><span class="line"><span class="cl">spring.elasticsearch.rest.uris=http://localhost:9200
</span></span><span class="line"><span class="cl">spring.elasticsearch.rest.username=elasticsearch
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>使用</p>
<ul>
<li>
<p>旧版的核心访问对象是ElasticsearchTemplate；新版的核心访问对象是ElasticsearchRestTemplate；</p>
</li>
<li>
<p>实体类没有类型</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// @Document指定当前类是索引对象。indexName:索引名称;shards:创建索引时的分片数;replicas:创建索引时的备份数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Document</span><span class="o">(</span><span class="n">indexName</span> <span class="o">=</span> <span class="s">&#34;book_&#34;</span><span class="o">,</span> <span class="n">shards</span> <span class="o">=</span> <span class="n">5</span><span class="o">,</span> <span class="n">replicas</span> <span class="o">=</span> <span class="n">1</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 0001-01-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/elasticsearch/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/frp-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="prev" rel="prev" title="FRP 内网穿透"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>FRP 内网穿透</a>
            <a href="/drools/" class="next" rel="next" title="Drools">Drools<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2018 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/coderabbit214" target="_blank">coderabbit</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
